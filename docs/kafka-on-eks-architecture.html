<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HighPipe Kafka on EKS ì•„í‚¤í…ì²˜</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .nav {
            background: #f1f5f9;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            background: #2563eb;
        }
        
        .nav-btn.active {
            background: #1d4ed8;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .zoom-controls {
            display: flex;
            gap: 5px;
        }
        
        .zoom-btn {
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        .zoom-btn:hover {
            background: #4f46e5;
        }
        
        .content {
            padding: 30px;
        }
        
        .diagram-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .diagram-section.active {
            display: block;
        }
        
        .diagram-section h2 {
            color: #1e293b;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .diagram-container {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow: auto;
            min-height: 700px;
            position: relative;
        }
        
        .diagram-wrapper {
            transform-origin: top left;
            transition: transform 0.3s ease;
            min-width: 100%;
        }
        
        .mermaid {
            text-align: center;
            min-height: 600px;
        }
        
        .mermaid svg {
            max-width: none !important;
            width: auto !important;
            height: auto !important;
            min-width: 1400px;
            font-size: 16px !important;
        }
        
        .description {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #10b981;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .k8s-note {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .k8s-note h4 {
            color: #1565c0;
            margin: 0 0 10px 0;
        }
        
        .k8s-note p {
            color: #0d47a1;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ HighPipe Kafka on EKS ì•„í‚¤í…ì²˜</h1>
            <p>EKS í´ëŸ¬ìŠ¤í„° ë‚´ Kafka ë°°í¬ ë° ìš´ì˜</p>
        </div>
        
        <div class="nav">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showDiagram('system')">ğŸ¢ ì „ì²´ ì‹œìŠ¤í…œ</button>
                <button class="nav-btn" onclick="showDiagram('kafka')">ğŸ“¨ Kafka on EKS</button>
                <button class="nav-btn" onclick="showDiagram('airflow')">ğŸŒŠ Airflow êµ¬ì„±</button>
                <button class="nav-btn" onclick="showDiagram('dataflow')">ğŸ”„ ë°ì´í„° í”Œë¡œìš°</button>
            </div>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">ğŸ”+</button>
                <button class="zoom-btn" onclick="zoomOut()">ğŸ”-</button>
                <button class="zoom-btn" onclick="resetZoom()">100%</button>
                <button class="zoom-btn" onclick="fitToScreen()">ğŸ“± ë§ì¶¤</button>
            </div>
        </div>
        
        <div class="content">
            <!-- ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ -->
            <div id="system" class="diagram-section active">
                <h2>ğŸ¢ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Kafka on EKS)</h2>
                
                <div class="k8s-note">
                    <h4>â˜¸ï¸ Kafka EKS ë°°í¬ ì „ëµ (ZooKeeper-less)</h4>
                    <p><strong>KRaft ëª¨ë“œ:</strong> Kafka 3.3+ KRaft(Kafka Raft) ì‚¬ìš©ìœ¼ë¡œ ZooKeeper ì˜ì¡´ì„± ì œê±°<br>
                    <strong>StatefulSet:</strong> Kafka ë¸Œë¡œì»¤ë¥¼ StatefulSetìœ¼ë¡œ ë°°í¬í•˜ì—¬ ì•ˆì •ì ì¸ ìŠ¤í† ë¦¬ì§€ ë³´ì¥<br>
                    <strong>Persistent Volume:</strong> EBS ê¸°ë°˜ ì˜êµ¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©<br>
                    <strong>Controller Nodes:</strong> ì¼ë¶€ ë¸Œë¡œì»¤ê°€ Controller ì—­í•  ê²¸ì„</p>
                </div>
                
                <div class="description">
                    <h3>EKS í´ëŸ¬ìŠ¤í„° ë‚´ Kafka ë°°í¬</h3>
                    <p>Kafkaë¥¼ EKS í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì— StatefulSetìœ¼ë¡œ ë°°í¬í•˜ì—¬ ì™„ì „í•œ ì»¨í…Œì´ë„ˆ ë„¤ì´í‹°ë¸Œ í™˜ê²½ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>
                </div>
                
                <div class="features">
                    <div class="feature">
                        <h4>ğŸ  ë¡œì»¬ í¬ë¡¤ë§</h4>
                        <p>FastAPI + Selenium, VPN ì—°ê²°</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸ“¨ Kafka on EKS</h4>
                        <p>StatefulSet ê¸°ë°˜ í´ëŸ¬ìŠ¤í„° ë°°í¬</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸŒŠ Airflow on EKS</h4>
                        <p>Pod ê¸°ë°˜ ë¶„ì‚° ë°°í¬, í™•ì¥ì„± í™•ë³´</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸ’¾ Persistent Storage</h4>
                        <p>EBS ê¸°ë°˜ ì˜êµ¬ ë³¼ë¥¨ ì‚¬ìš©</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="diagram-wrapper" id="current-diagram">
                        <div class="mermaid">
graph TB
    %% ì‚¬ìš©ì
    User[ğŸ‘¤ ì‚¬ìš©ì]
    Internet[ğŸŒ ì¸í„°ë„·]
    
    %% ë¡œì»¬ í™˜ê²½
    subgraph Local["ğŸ  ë¡œì»¬ í™˜ê²½"]
        CrawlingServer[ğŸ•·ï¸ í¬ë¡¤ë§ ì„œë²„<br/>FastAPI + Selenium<br/>ë©€í‹°í”„ë¡œì„¸ì‹±]
        VPNClient[ğŸ”’ VPN Client]
    end
    
    %% AWS í´ë¼ìš°ë“œ
    subgraph AWS["â˜ï¸ AWS Cloud"]
        subgraph VPC["ğŸ¢ VPC"]
            VPNGateway[ğŸ”’ VPN Gateway]
            
            subgraph PublicSubnet["ğŸŒ Public Subnet"]
                ALB[âš–ï¸ Application Load Balancer]
                NAT[ğŸšª NAT Gateway]
            end
            
            subgraph PrivateSubnet["ğŸ”’ Private Subnet"]
                subgraph EKS["â˜¸ï¸ EKS Cluster"]
                    
                    %% Web Tier
                    subgraph WebTier["ğŸ“± web-tier namespace"]
                        Frontend[âš›ï¸ React Frontend<br/>Pods: 3]
                        Nginx[ğŸ”„ Nginx LoadBalancer<br/>Pods: 2]
                        Ingress[ğŸšª Ingress Controller]
                    end
                    
                    %% Application Tier
                    subgraph AppTier["ğŸ”§ app-tier namespace"]
                        BackendAPI[ğŸ–¥ï¸ Backend API<br/>Node.js + Express<br/>Pods: 3-20 HPA]
                        WebSocket[ğŸ”Œ WebSocket Server<br/>Socket.IO<br/>Pods: 2-10 HPA]
                    end
                    
                    %% Airflow Tier
                    subgraph AirflowTier["ğŸŒŠ airflow namespace"]
                        AirflowWebServer[ğŸŒ Airflow WebServer<br/>Pod: 1-3]
                        AirflowScheduler[ğŸ“… Airflow Scheduler<br/>Pod: 1]
                        AirflowWorker[ğŸ‘· Airflow Worker<br/>Pods: 2-10 HPA]
                        GitSync[ğŸ“¦ Git-Sync<br/>DAG ë™ê¸°í™”<br/>Pod: 1]
                    end
                    
                    %% Kafka Tier (EKS ë‚´ë¶€, KRaft ëª¨ë“œ)
                    subgraph KafkaTier["ğŸ“¨ kafka namespace"]
                        subgraph KafkaCluster["ğŸ“¨ Kafka í´ëŸ¬ìŠ¤í„° (KRaft ëª¨ë“œ)"]
                            Kafka1[ğŸ“¨ kafka-0<br/>Controller + Broker<br/>PVC: kafka-data-0<br/>50Gi EBS<br/>KRaft ëª¨ë“œ]
                            Kafka2[ğŸ“¨ kafka-1<br/>Controller + Broker<br/>PVC: kafka-data-1<br/>50Gi EBS<br/>KRaft ëª¨ë“œ]
                            Kafka3[ğŸ“¨ kafka-2<br/>Controller + Broker<br/>PVC: kafka-data-2<br/>50Gi EBS<br/>KRaft ëª¨ë“œ]
                        end
                        
                        KafkaManager[ğŸ›ï¸ Kafka UI<br/>ê´€ë¦¬ ë„êµ¬<br/>Deployment Pod]
                        KafkaExporter[ğŸ“Š Kafka Exporter<br/>Prometheus ë©”íŠ¸ë¦­<br/>DaemonSet]
                        KafkaConnect[ğŸ”— Kafka Connect<br/>ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™<br/>Deployment Pod]
                    end
                    
                    %% Pipeline Tier
                    subgraph PipelineTier["ğŸ”„ pipeline-tier namespace"]
                        SparkCluster[âš¡ Spark Cluster<br/>Streaming Processing<br/>Driver: 1 Executors: 2-10]
                        AnalysisServer[ğŸ§  LLM Analysis Server<br/>FastAPI + GPU<br/>Pods: 1-5 HPA]
                    end
                    
                    %% Data Tier (Redisë§Œ)
                    subgraph DataTier["ğŸ’¾ data-tier namespace"]
                        Redis[ğŸ”´ Redis Cluster<br/>ìºì‹œ + ì„¸ì…˜<br/>Master: 1 Slaves: 2]
                        PostgresProxy[ğŸ˜ PostgreSQL Proxy<br/>Connection Pooling]
                    end
                    
                    %% Monitoring
                    subgraph Monitoring["ğŸ“Š monitoring namespace"]
                        Prometheus[ğŸ“ˆ Prometheus<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘<br/>Pod: 1]
                        Grafana[ğŸ“Š Grafana<br/>ì‹œê°í™”<br/>Pod: 1]
                        AlertManager[ğŸš¨ AlertManager<br/>ì•Œë¦¼<br/>Pod: 1]
                    end
                end
            end
        end
        
        %% AWS ê´€ë¦¬í˜• ì„œë¹„ìŠ¤
        subgraph ManagedServices["ğŸ› ï¸ AWS ê´€ë¦¬í˜• ì„œë¹„ìŠ¤"]
            RDSWeb[ğŸ—„ï¸ RDS PostgreSQL<br/>ì›¹ ì„œë¹„ìŠ¤ DB<br/>Multi-AZ]
            RDSAirflow[ğŸ—„ï¸ RDS PostgreSQL<br/>Airflow ë©”íƒ€ë°ì´í„° DB<br/>Multi-AZ]
            S3DataLake[ğŸª£ S3 Data Lake<br/>ì›ë³¸ ë¦¬ë·° ë°ì´í„°<br/>íŒŒí‹°ì…˜ êµ¬ì¡°]
            S3Logs[ğŸª£ S3 Airflow Logs<br/>ë¡œê·¸ ì €ì¥ì†Œ]
            Redshift[ğŸ­ Redshift<br/>Data Warehouse<br/>ë¶„ì„ ê²°ê³¼ ì €ì¥]
            ECR[ğŸ“¦ ECR<br/>Container Registry]
            SecretsManager[ğŸ” Secrets Manager<br/>ì¸ì¦ ì •ë³´ ê´€ë¦¬]
            CloudWatch[ğŸ“Š CloudWatch<br/>ë¡œê·¸ + ë©”íŠ¸ë¦­]
            EBS[ğŸ’¾ EBS Volumes<br/>Kafka/ZK ì˜êµ¬ ìŠ¤í† ë¦¬ì§€]
        end
    end
    
    %% ì—°ê²° ê´€ê³„
    User --> Internet
    Internet --> ALB
    ALB --> Ingress
    Ingress --> Frontend
    Ingress --> BackendAPI
    Ingress --> AirflowWebServer
    Ingress --> KafkaManager
    
    %% ì›¹ ì„œë¹„ìŠ¤ ë‚´ë¶€ í†µì‹ 
    Frontend --> BackendAPI
    BackendAPI --> WebSocket
    BackendAPI --> Redis
    BackendAPI --> PostgresProxy
    BackendAPI --> Kafka1
    
    %% VPN ì—°ê²°
    VPNClient -.->|VPN í„°ë„| VPNGateway
    CrawlingServer --> VPNClient
    VPNGateway --> Kafka2
    
    %% Airflow êµ¬ì„±
    AirflowScheduler --> AirflowWorker
    AirflowWebServer --> RDSAirflow
    AirflowScheduler --> RDSAirflow
    AirflowWorker --> RDSAirflow
    GitSync --> AirflowScheduler
    AirflowWorker --> S3Logs
    
    %% Airflow ì›Œí¬í”Œë¡œìš°
    AirflowWorker -.->|API í˜¸ì¶œ| CrawlingServer
    AirflowWorker --> SparkCluster
    AirflowWorker --> AnalysisServer
    
    %% Kafka í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ í†µì‹  (KRaft ëª¨ë“œ)
    Kafka1 --> Kafka2
    Kafka2 --> Kafka3
    Kafka3 --> Kafka1
    
    %% ë°ì´í„° í”Œë¡œìš°
    CrawlingServer -.->|VPN| Kafka2
    Kafka2 --> SparkCluster
    SparkCluster --> Kafka3
    Kafka3 --> AnalysisServer
    AnalysisServer --> Kafka1
    Kafka1 --> BackendAPI
    
    %% ë°ì´í„° ì €ì¥
    CrawlingServer -.->|VPN| S3DataLake
    SparkCluster --> S3DataLake
    SparkCluster --> Redshift
    AnalysisServer --> Redshift
    
    %% ì˜êµ¬ ìŠ¤í† ë¦¬ì§€
    Kafka1 --> EBS
    Kafka2 --> EBS
    Kafka3 --> EBS
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    PostgresProxy --> RDSWeb
    
    %% ëª¨ë‹ˆí„°ë§
    KafkaExporter --> Prometheus
    Prometheus --> BackendAPI
    Prometheus --> Kafka1
    Prometheus --> Redis
    Prometheus --> AirflowScheduler
    Grafana --> Prometheus
    AlertManager --> Prometheus
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°
    BackendAPI --> SecretsManager
    AirflowScheduler --> SecretsManager
    AnalysisServer --> S3DataLake
    
    %% ë¡œê¹…
    BackendAPI --> CloudWatch
    AirflowScheduler --> CloudWatch
    AnalysisServer --> CloudWatch
    Kafka1 --> CloudWatch
    CrawlingServer -.->|VPN| CloudWatch
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef local fill:#FFF2CC,stroke:#D6B656,stroke-width:3px,color:#000
    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef k8s fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef app fill:#4CAF50,stroke:#fff,stroke-width:2px,color:#fff
    classDef data fill:#2196F3,stroke:#fff,stroke-width:2px,color:#fff
    classDef monitor fill:#FF5722,stroke:#fff,stroke-width:2px,color:#fff
    classDef airflow fill:#017CEE,stroke:#fff,stroke-width:2px,color:#fff
    classDef kafka fill:#E91E63,stroke:#fff,stroke-width:2px,color:#fff
    classDef zk fill:#795548,stroke:#fff,stroke-width:2px,color:#fff
    classDef vpn fill:#9C27B0,stroke:#fff,stroke-width:2px,color:#fff
    classDef storage fill:#607D8B,stroke:#fff,stroke-width:2px,color:#fff
    
    class Local,CrawlingServer local
    class AWS,ManagedServices aws
    class EKS,WebTier,AppTier,PipelineTier,DataTier k8s
    class Frontend,BackendAPI,WebSocket,AnalysisServer app
    class Redis,PostgresProxy,RDSWeb,S3DataLake,S3Logs,Redshift data
    class Monitoring,Prometheus,Grafana,AlertManager monitor
    class AirflowTier,AirflowWebServer,AirflowScheduler,AirflowWorker,GitSync airflow
    class KafkaTier,Kafka1,Kafka2,Kafka3,KafkaManager,KafkaExporter kafka
    class ZK1,ZK2,ZK3 zk
    class VPNClient,VPNGateway vpn
    class EBS storage
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kafka on EKS -->
            <div id="kafka" class="diagram-section">
                <h2>ğŸ“¨ Kafka on EKS ìƒì„¸ êµ¬ì„±</h2>
                <div class="description">
                    <h3>KRaft ëª¨ë“œ Kafka í´ëŸ¬ìŠ¤í„° (ZooKeeper-less)</h3>
                    <p>EKS í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ StatefulSetìœ¼ë¡œ ë°°í¬ë˜ëŠ” KRaft ëª¨ë“œ Kafkaì˜ ìƒì„¸ êµ¬ì„±ì…ë‹ˆë‹¤. ZooKeeper ì—†ì´ ìš´ì˜ë©ë‹ˆë‹¤.</p>
                </div>
                
                <div class="features">
                    <div class="feature">
                        <h4>ğŸ“¨ Kafka StatefulSet</h4>
                        <p>3ê°œ ë¸Œë¡œì»¤, ê°ê° 50Gi EBS ë³¼ë¥¨</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸ¯ KRaft ëª¨ë“œ</h4>
                        <p>ZooKeeper ì—†ëŠ” Kafka 3.3+ ì‚¬ìš©</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸ›ï¸ ê´€ë¦¬ ë„êµ¬</h4>
                        <p>Kafka Manager UI, Prometheus Exporter</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸ”§ Helm ë°°í¬</h4>
                        <p>Strimzi Operator (KRaft ì§€ì›) ê¶Œì¥</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="diagram-wrapper">
                        <div class="mermaid">
graph TB
    %% Kafka Namespace (KRaft ëª¨ë“œ)
    subgraph KafkaNamespace["ğŸ“¨ kafka namespace"]
        
        %% Kafka StatefulSet (KRaft ëª¨ë“œ)
        subgraph KafkaStatefulSet["ğŸ“¨ Kafka StatefulSet (KRaft ëª¨ë“œ)"]
            subgraph KafkaPod1["kafka-0 Pod"]
                KafkaContainer1[ğŸ“¨ Kafka Container<br/>Image: apache/kafka:3.6.0<br/>Port: 9092, 9093<br/>Role: Controller + Broker<br/>JVM Heap: 2Gi<br/>KRaft ëª¨ë“œ]
                KafkaVolume1[ğŸ’¾ kafka-data-0<br/>PVC: 50Gi<br/>StorageClass: gp3<br/>Mount: /var/lib/kafka/data]
                KafkaLogVolume1[ğŸ“ kafka-logs-0<br/>PVC: 10Gi<br/>StorageClass: gp3<br/>Mount: /var/lib/kafka/logs]
            end
            
            subgraph KafkaPod2["kafka-1 Pod"]
                KafkaContainer2[ğŸ“¨ Kafka Container<br/>Image: apache/kafka:3.6.0<br/>Port: 9092, 9093<br/>Role: Controller + Broker<br/>JVM Heap: 2Gi<br/>KRaft ëª¨ë“œ]
                KafkaVolume2[ğŸ’¾ kafka-data-1<br/>PVC: 50Gi<br/>StorageClass: gp3<br/>Mount: /var/lib/kafka/data]
                KafkaLogVolume2[ğŸ“ kafka-logs-1<br/>PVC: 10Gi<br/>StorageClass: gp3<br/>Mount: /var/lib/kafka/logs]
            end
            
            subgraph KafkaPod3["kafka-2 Pod"]
                KafkaContainer3[ğŸ“¨ Kafka Container<br/>Image: apache/kafka:3.6.0<br/>Port: 9092, 9093<br/>Role: Controller + Broker<br/>JVM Heap: 2Gi<br/>KRaft ëª¨ë“œ]
                KafkaVolume3[ğŸ’¾ kafka-data-2<br/>PVC: 50Gi<br/>StorageClass: gp3<br/>Mount: /var/lib/kafka/data]
                KafkaLogVolume3[ğŸ“ kafka-logs-2<br/>PVC: 10Gi<br/>StorageClass: gp3<br/>Mount: /var/lib/kafka/logs]
            end
        end
        
        %% Services
        subgraph KafkaServices["ğŸŒ Kubernetes Services"]
            KafkaHeadlessService[ğŸ“¨ kafka-headless<br/>ClusterIP: None<br/>Ports: 9092, 9093<br/>StatefulSet DNS]
            KafkaService[ğŸ“¨ kafka-service<br/>ClusterIP<br/>Port: 9092<br/>Load Balancer]
            KafkaControllerService[ğŸ¯ kafka-controller<br/>ClusterIP<br/>Port: 9093<br/>Controller Access]
        end
        
        %% Management Tools
        subgraph ManagementTools["ğŸ› ï¸ ê´€ë¦¬ ë„êµ¬"]
            KafkaUI[ğŸ›ï¸ Kafka UI<br/>Deployment<br/>Image: provectuslabs/kafka-ui<br/>Port: 8080]
            KafkaExporter[ğŸ“Š Kafka Exporter<br/>DaemonSet<br/>Image: danielqsj/kafka-exporter<br/>Port: 9308]
            KafkaConnect[ğŸ”— Kafka Connect<br/>Deployment<br/>Image: confluentinc/cp-kafka-connect<br/>Port: 8083]
        end
        
        %% ConfigMaps and Secrets
        subgraph Configuration["âš™ï¸ ì„¤ì •"]
            KafkaConfigMap[ğŸ“‹ kafka-config<br/>ConfigMap<br/>server.properties<br/>kraft.properties<br/>log4j.properties]
            KafkaSecret[ğŸ” kafka-secret<br/>Secret<br/>SASL credentials<br/>SSL certificates<br/>Controller quorum]
        end
    end
    
    %% External Connections
    subgraph ExternalSystems["ğŸ”— ì™¸ë¶€ ì‹œìŠ¤í…œ"]
        BackendAPI[ğŸ–¥ï¸ Backend API<br/>Producer/Consumer]
        AirflowWorker[ğŸŒŠ Airflow Worker<br/>Consumer]
        SparkCluster[âš¡ Spark Cluster<br/>Consumer/Producer]
        AnalysisServer[ğŸ§  Analysis Server<br/>Producer]
        LocalCrawler[ğŸ  ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„<br/>Producer via VPN]
    end
    
    %% KRaft í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ í†µì‹ 
    KafkaContainer1 --> KafkaContainer2
    KafkaContainer2 --> KafkaContainer3
    KafkaContainer3 --> KafkaContainer1
    
    KafkaHeadlessService --> KafkaContainer1
    KafkaHeadlessService --> KafkaContainer2
    KafkaHeadlessService --> KafkaContainer3
    
    KafkaService --> KafkaContainer1
    KafkaService --> KafkaContainer2
    KafkaService --> KafkaContainer3
    
    KafkaControllerService --> KafkaContainer1
    KafkaControllerService --> KafkaContainer2
    KafkaControllerService --> KafkaContainer3
    
    KafkaUI --> KafkaService
    KafkaExporter --> KafkaService
    KafkaConnect --> KafkaService
    
    KafkaConfigMap --> KafkaContainer1
    KafkaConfigMap --> KafkaContainer2
    KafkaConfigMap --> KafkaContainer3
    
    KafkaSecret --> KafkaContainer1
    KafkaSecret --> KafkaContainer2
    KafkaSecret --> KafkaContainer3
    
    %% External connections
    BackendAPI --> KafkaService
    AirflowWorker --> KafkaService
    SparkCluster --> KafkaService
    AnalysisServer --> KafkaService
    LocalCrawler -.->|VPN| KafkaService
    
    %% Storage connections
    KafkaContainer1 --> KafkaVolume1
    KafkaContainer1 --> KafkaLogVolume1
    KafkaContainer2 --> KafkaVolume2
    KafkaContainer2 --> KafkaLogVolume2
    KafkaContainer3 --> KafkaVolume3
    KafkaContainer3 --> KafkaLogVolume3
    
    %% Styling
    classDef kafkaPod fill:#E91E63,stroke:#fff,stroke-width:2px,color:#fff
    classDef volume fill:#607D8B,stroke:#fff,stroke-width:2px,color:#fff
    classDef service fill:#2196F3,stroke:#fff,stroke-width:2px,color:#fff
    classDef management fill:#FF9800,stroke:#fff,stroke-width:2px,color:#fff
    classDef config fill:#4CAF50,stroke:#fff,stroke-width:2px,color:#fff
    classDef external fill:#9C27B0,stroke:#fff,stroke-width:2px,color:#fff
    
    class KafkaContainer1,KafkaContainer2,KafkaContainer3 kafkaPod
    class KafkaVolume1,KafkaVolume2,KafkaVolume3,KafkaLogVolume1,KafkaLogVolume2,KafkaLogVolume3 volume
    class KafkaHeadlessService,KafkaService,KafkaControllerService service
    class KafkaUI,KafkaExporter,KafkaConnect management
    class KafkaConfigMap,KafkaSecret config
    class BackendAPI,AirflowWorker,SparkCluster,AnalysisServer,LocalCrawler external
                        </div>
                    </div>
                </div>
                
                <div class="k8s-note">
                    <h4>ğŸ“¨ Kafka KRaft ëª¨ë“œ EKS ë°°í¬ ì„¤ì •</h4>
                    <p><strong>Operator:</strong> Strimzi Kafka Operator (KRaft ëª¨ë“œ ì§€ì›)<br>
                    <strong>Resource Limits:</strong> Kafka Controller+Broker (CPU: 1000m, Memory: 3Gi)<br>
                    <strong>Storage Class:</strong> gp3 (ê³ ì„±ëŠ¥ SSD), ë°ì´í„° + ë¡œê·¸ ë³¼ë¥¨ ë¶„ë¦¬<br>
                    <strong>Controller Quorum:</strong> 3ê°œ ë…¸ë“œ ëª¨ë‘ Controller ì—­í•  ìˆ˜í–‰<br>
                    <strong>Network Policy:</strong> ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°„ í†µì‹  ì œì–´ ë° ë³´ì•ˆ ê°•í™”</p>
                </div>
            </div>
            
            <!-- Airflow êµ¬ì„± -->
            <div id="airflow" class="diagram-section">
                <h2>ğŸŒŠ Airflow EKS êµ¬ì„±</h2>
                <div class="description">
                    <h3>Pod ê¸°ë°˜ Airflow ë¶„ì‚° ë°°í¬</h3>
                    <p>EKS ë‚´ Airflow êµ¬ì„±ìœ¼ë¡œ Kafkaì™€ ë™ì¼í•œ í´ëŸ¬ìŠ¤í„°ì—ì„œ ìš´ì˜ë©ë‹ˆë‹¤.</p>
                </div>
                <div class="diagram-container">
                    <div class="diagram-wrapper">
                        <div class="mermaid">
graph TB
    %% Airflow ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (ê°„ë‹¨ ë²„ì „)
    subgraph AirflowNamespace["ğŸŒŠ airflow namespace"]
        AirflowWebServer[ğŸŒ Airflow WebServer<br/>Pod: 1-3]
        AirflowScheduler[ğŸ“… Airflow Scheduler<br/>Pod: 1]
        AirflowWorker[ğŸ‘· Airflow Worker<br/>Pods: 2-10 HPA]
        GitSync[ğŸ“¦ Git-Sync<br/>DAG ë™ê¸°í™”<br/>Pod: 1]
    end
    
    %% Kafka ì—°ê²°
    subgraph KafkaConnection["ğŸ“¨ Kafka ì—°ê²°"]
        KafkaService[ğŸ“¨ kafka-service.kafka.svc.cluster.local:9092]
    end
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤
    subgraph ExternalServices["ğŸ› ï¸ ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        RDSAirflow[ğŸ—„ï¸ RDS PostgreSQL<br/>Airflow ë©”íƒ€ë°ì´í„° DB]
        S3Logs[ğŸª£ S3 Airflow Logs<br/>ë¡œê·¸ ì €ì¥ì†Œ]
        LocalCrawler[ğŸ  ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„<br/>VPN ì—°ê²°]
    end
    
    %% ì—°ê²°
    AirflowScheduler --> AirflowWorker
    AirflowWebServer --> RDSAirflow
    AirflowScheduler --> RDSAirflow
    AirflowWorker --> RDSAirflow
    GitSync --> AirflowScheduler
    AirflowWorker --> S3Logs
    AirflowWorker --> KafkaService
    AirflowWorker -.->|API í˜¸ì¶œ| LocalCrawler
    
    classDef airflow fill:#017CEE,stroke:#fff,stroke-width:2px,color:#fff
    classDef kafka fill:#E91E63,stroke:#fff,stroke-width:2px,color:#fff
    classDef external fill:#9C27B0,stroke:#fff,stroke-width:2px,color:#fff
    
    class AirflowWebServer,AirflowScheduler,AirflowWorker,GitSync airflow
    class KafkaService kafka
    class RDSAirflow,S3Logs,LocalCrawler external
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë°ì´í„° í”Œë¡œìš° -->
            <div id="dataflow" class="diagram-section">
                <h2>ğŸ”„ ë°ì´í„° í”Œë¡œìš° (Kafka on EKS)</h2>
                <div class="description">
                    <h3>EKS ë‚´ Kafkaë¥¼ í†µí•œ ë°ì´í„° ì²˜ë¦¬</h3>
                    <p>ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ EKS í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ í†µì‹ í•˜ëŠ” ì™„ì „í•œ ì»¨í…Œì´ë„ˆ ë„¤ì´í‹°ë¸Œ í™˜ê²½ì…ë‹ˆë‹¤.</p>
                </div>
                <div class="diagram-container">
                    <div class="diagram-wrapper">
                        <div class="mermaid">
sequenceDiagram
    participant User as ğŸ‘¤ ì‚¬ìš©ì
    participant Frontend as âš›ï¸ Frontend
    participant API as ğŸ–¥ï¸ Backend API
    participant WS as ğŸ”Œ WebSocket
    participant Kafka as ğŸ“¨ Kafka on EKS
    participant Airflow as ğŸŒŠ Airflow
    participant LocalCrawler as ğŸ  ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„
    participant Spark as âš¡ Spark
    participant Analysis as ğŸ§  Analysis
    participant S3 as ğŸª£ S3
    participant Redshift as ğŸ­ Redshift
    participant RDS as ğŸ—„ï¸ RDS
    participant Redis as ğŸ”´ Redis
    
    User->>Frontend: ìƒí’ˆ ë¶„ì„ ìš”ì²­
    Frontend->>API: POST /api/analysis/start
    API->>Kafka: ë¶„ì„ ìš”ì²­ ë©”ì‹œì§€ ë°œí–‰<br/>Topic: analysis-requests
    API->>Redis: ìš”ì²­ ìƒíƒœ ìºì‹±
    API-->>Frontend: ë¶„ì„ ID ë°˜í™˜
    
    Frontend->>WS: WebSocket ì—°ê²° (ë¶„ì„ ID)
    
    Kafka->>Airflow: Consumer: analysis-requests<br/>DAG íŠ¸ë¦¬ê±°
    Airflow->>LocalCrawler: VPNì„ í†µí•œ API í˜¸ì¶œ
    
    Note over LocalCrawler: ë©€í‹°í”„ë¡œì„¸ì‹± í¬ë¡¤ë§ ì‹¤í–‰
    
    loop í¬ë¡¤ë§ ì§„í–‰
        LocalCrawler-->>Kafka: VPN â†’ Producer: crawling-status
        Kafka->>API: Consumer: crawling-status
        API->>WS: ì‹¤ì‹œê°„ ìƒíƒœ ì „ì†¡
        WS-->>Frontend: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    end
    
    LocalCrawler-->>S3: VPNì„ í†µí•œ ì›ë³¸ ë°ì´í„° ì €ì¥
    LocalCrawler-->>Kafka: VPN â†’ Producer: raw-review-data
    
    Kafka->>Spark: Consumer: raw-review-data<br/>KubernetesPodOperator
    Spark->>S3: ì „ì²˜ë¦¬ëœ ë°ì´í„° ì €ì¥
    Spark->>Kafka: Producer: processed-review-data
    
    Kafka->>Analysis: Consumer: processed-review-data<br/>KubernetesPodOperator
    
    loop ë¶„ì„ ì§„í–‰
        Analysis->>Kafka: Producer: analysis-status
        Kafka->>API: Consumer: analysis-status
        API->>WS: ì‹¤ì‹œê°„ ìƒíƒœ ì „ì†¡
        WS-->>Frontend: ë¶„ì„ ì§„í–‰ë¥ 
        
        Analysis->>Kafka: Producer: sentiment-cards
        Kafka->>API: Consumer: sentiment-cards
        API->>Redis: ì¹´ë“œ ë°ì´í„° ì„ì‹œ ì €ì¥
        API->>WS: ì‹¤ì‹œê°„ ì¹´ë“œ ì „ì†¡
        WS-->>Frontend: ê°ì • ì¹´ë“œ í‘œì‹œ
    end
    
    Analysis->>Redshift: ìµœì¢… ë¶„ì„ ê²°ê³¼ ì €ì¥
    Analysis->>RDS: ì›¹ ì„œë¹„ìŠ¤ìš© ê²°ê³¼ ì €ì¥
    Analysis->>Kafka: Producer: analysis-results
    Kafka->>API: Consumer: analysis-results
    API->>WS: ë¶„ì„ ì™„ë£Œ ì•Œë¦¼
    WS-->>Frontend: ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
    
    Frontend->>API: GET /api/analysis/{id}/results
    API->>RDS: ë¶„ì„ ê²°ê³¼ ì¡°íšŒ
    API->>Redis: ê²°ê³¼ ìºì‹±
    API-->>Frontend: ë¶„ì„ ê²°ê³¼ ë°˜í™˜
    
    Note over Kafka: EKS ë‚´ Kafka í´ëŸ¬ìŠ¤í„°<br/>- StatefulSet ë°°í¬<br/>- ì˜êµ¬ ë³¼ë¥¨ ì‚¬ìš©<br/>- í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ í†µì‹ 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentZoom = 1;
        
        // Mermaid ì´ˆê¸°í™”
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'Arial, sans-serif',
            fontSize: 16,
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 30,
                nodeSpacing: 80,
                rankSpacing: 100
            },
            sequence: {
                useMaxWidth: false,
                width: 200,
                height: 100,
                actorMargin: 80,
                boxMargin: 15,
                messageMargin: 50
            }
        });

        function showDiagram(diagramId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sections = document.querySelectorAll('.diagram-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            const targetSection = document.getElementById(diagramId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            event.target.classList.add('active');
            
            // ì¤Œ ë¦¬ì…‹
            resetZoom();
            
            // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            applyZoom();
        }
        
        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.3);
            applyZoom();
        }
        
        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }
        
        function fitToScreen() {
            const container = document.querySelector('.diagram-section.active .diagram-container');
            const diagram = document.querySelector('.diagram-section.active .diagram-wrapper');
            if (container && diagram) {
                const containerWidth = container.clientWidth - 40;
                const diagramWidth = diagram.scrollWidth;
                currentZoom = Math.min(containerWidth / diagramWidth, 1);
                applyZoom();
            }
        }
        
        function applyZoom() {
            const activeDiagram = document.querySelector('.diagram-section.active .diagram-wrapper');
            if (activeDiagram) {
                activeDiagram.style.transform = `scale(${currentZoom})`;
            }
            
            // ì¤Œ ë ˆë²¨ í‘œì‹œ ì—…ë°ì´íŠ¸
            const zoomDisplay = Math.round(currentZoom * 100);
            document.querySelector('.zoom-controls .zoom-btn:nth-child(3)').textContent = `${zoomDisplay}%`;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸° ì„¤ì •
        window.addEventListener('load', function() {
            setTimeout(() => {
                mermaid.init();
                setTimeout(fitToScreen, 1000);
            }, 100);
        });
    </script>
</body>
</html>