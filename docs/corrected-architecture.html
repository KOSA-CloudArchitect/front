<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HighPipe ì •í™•í•œ EKS ì•„í‚¤í…ì²˜</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .nav {
            background: #f1f5f9;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            background: #2563eb;
        }
        
        .nav-btn.active {
            background: #1d4ed8;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .zoom-controls {
            display: flex;
            gap: 5px;
        }
        
        .zoom-btn {
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        .zoom-btn:hover {
            background: #4f46e5;
        }
        
        .content {
            padding: 30px;
        }
        
        .diagram-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .diagram-section.active {
            display: block;
        }
        
        .diagram-section h2 {
            color: #1e293b;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .diagram-container {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow: auto;
            min-height: 700px;
            position: relative;
        }
        
        .diagram-wrapper {
            transform-origin: top left;
            transition: transform 0.3s ease;
            min-width: 100%;
        }
        
        .mermaid {
            text-align: center;
            min-height: 600px;
        }
        
        .mermaid svg {
            max-width: none !important;
            width: auto !important;
            height: auto !important;
            min-width: 1400px;
            font-size: 16px !important;
        }
        
        .description {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #10b981;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .correction-note {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .correction-note h4 {
            color: #92400e;
            margin: 0 0 10px 0;
        }
        
        .correction-note p {
            color: #78350f;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ HighPipe ì •í™•í•œ EKS ì•„í‚¤í…ì²˜</h1>
            <p>ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„ì™€ EKS ê¸°ë°˜ ë°ì´í„° íŒŒì´í”„ë¼ì¸</p>
        </div>
        
        <div class="nav">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showDiagram('system')">ğŸ¢ ì „ì²´ ì‹œìŠ¤í…œ</button>
                <button class="nav-btn" onclick="showDiagram('dataflow')">ğŸ”„ ë°ì´í„° í”Œë¡œìš°</button>
                <button class="nav-btn" onclick="showDiagram('airflow')">ğŸŒŠ Airflow DAG</button>
            </div>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">ğŸ”+</button>
                <button class="zoom-btn" onclick="zoomOut()">ğŸ”-</button>
                <button class="zoom-btn" onclick="resetZoom()">100%</button>
                <button class="zoom-btn" onclick="fitToScreen()">ğŸ“± ë§ì¶¤</button>
            </div>
        </div>
        
        <div class="content">
            <!-- ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ -->
            <div id="system" class="diagram-section active">
                <h2>ğŸ¢ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (ìˆ˜ì •ë¨)</h2>
                
                <div class="correction-note">
                    <h4>ğŸ”§ ì•„í‚¤í…ì²˜ ìˆ˜ì •ì‚¬í•­</h4>
                    <p><strong>í¬ë¡¤ë§ ì„œë²„:</strong> ë¡œì»¬ í™˜ê²½ì—ì„œ ë³„ë„ ìš´ì˜ (EKS ì™¸ë¶€)<br>
                    <strong>Airflow:</strong> ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë‹´ë‹¹<br>
                    <strong>í†µì‹ :</strong> VPN/VPC ì—°ê²°ì„ í†µí•œ í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°</p>
                </div>
                
                <div class="description">
                    <h3>í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜</h3>
                    <p>ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„ì™€ EKS í´ëŸ¬ìŠ¤í„°ê°€ VPNìœ¼ë¡œ ì—°ê²°ëœ í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°ì…ë‹ˆë‹¤. Airflowê°€ ì „ì²´ ë°ì´í„° íŒŒì´í”„ë¼ì¸ì„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>
                </div>
                
                <div class="features">
                    <div class="feature">
                        <h4>ğŸ  ë¡œì»¬ í™˜ê²½</h4>
                        <p>í¬ë¡¤ë§ ì„œë²„ (FastAPI + Selenium), VPN ì—°ê²°</p>
                    </div>
                    <div class="feature">
                        <h4>â˜ï¸ EKS í´ëŸ¬ìŠ¤í„°</h4>
                        <p>ì›¹ ì„œë¹„ìŠ¤, Airflow, ë¶„ì„ ì„œë²„, ë°ì´í„° ì €ì¥ì†Œ</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸŒŠ Airflow ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</h4>
                        <p>DAG ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° ê´€ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§</p>
                    </div>
                    <div class="feature">
                        <h4>ğŸ“¨ Kafka ë©”ì‹œì§•</h4>
                        <p>ë¹„ë™ê¸° ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ </p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="diagram-wrapper" id="current-diagram">
                        <div class="mermaid">
graph TB
    %% ì‚¬ìš©ì
    User[ğŸ‘¤ ì‚¬ìš©ì]
    Internet[ğŸŒ ì¸í„°ë„·]
    
    %% ë¡œì»¬ í™˜ê²½
    subgraph Local["ğŸ  ë¡œì»¬ í™˜ê²½"]
        CrawlingServer[ğŸ•·ï¸ í¬ë¡¤ë§ ì„œë²„<br/>FastAPI + Selenium<br/>ë©€í‹°í”„ë¡œì„¸ì‹±]
        VPNClient[ğŸ”’ VPN Client]
    end
    
    %% AWS í´ë¼ìš°ë“œ
    subgraph AWS["â˜ï¸ AWS Cloud"]
        subgraph VPC["ğŸ¢ VPC"]
            VPNGateway[ğŸ”’ VPN Gateway]
            
            subgraph PublicSubnet["ğŸŒ Public Subnet"]
                ALB[âš–ï¸ Application Load Balancer]
                NAT[ğŸšª NAT Gateway]
            end
            
            subgraph PrivateSubnet["ğŸ”’ Private Subnet"]
                subgraph EKS["â˜¸ï¸ EKS Cluster"]
                    
                    %% Web Tier
                    subgraph WebTier["ğŸ“± web-tier namespace"]
                        Frontend[âš›ï¸ React Frontend<br/>Pods: 3]
                        Nginx[ğŸ”„ Nginx LoadBalancer<br/>Pods: 2]
                        Ingress[ğŸšª Ingress Controller]
                    end
                    
                    %% Application Tier
                    subgraph AppTier["ğŸ”§ app-tier namespace"]
                        BackendAPI[ğŸ–¥ï¸ Backend API<br/>Node.js + Express<br/>Pods: 3-20 HPA]
                        WebSocket[ğŸ”Œ WebSocket Server<br/>Socket.IO<br/>Pods: 2-10 HPA]
                        
                        subgraph AirflowCluster["ğŸŒŠ Airflow í´ëŸ¬ìŠ¤í„°"]
                            AirflowScheduler[ğŸ“… Airflow Scheduler<br/>DAG ê´€ë¦¬<br/>Pod: 1]
                            AirflowWebserver[ğŸŒ Airflow Webserver<br/>UI + API<br/>Pods: 2]
                            AirflowWorker[ğŸ‘· Airflow Workers<br/>Celery Executor<br/>Pods: 2-10 HPA]
                        end
                    end
                    
                    %% Pipeline Tier
                    subgraph PipelineTier["ğŸ”„ pipeline-tier namespace"]
                        SparkCluster[âš¡ Spark Cluster<br/>Streaming Processing<br/>Driver: 1 Executors: 2-10]
                        AnalysisServer[ğŸ§  LLM Analysis Server<br/>FastAPI + GPU<br/>Pods: 1-5 HPA]
                    end
                    
                    %% Data Tier
                    subgraph DataTier["ğŸ’¾ data-tier namespace"]
                        subgraph KafkaCluster["ğŸ“¨ Kafka í´ëŸ¬ìŠ¤í„°"]
                            Kafka1[ğŸ“¨ Kafka Broker 1]
                            Kafka2[ğŸ“¨ Kafka Broker 2]
                            Kafka3[ğŸ“¨ Kafka Broker 3]
                            Zookeeper[ğŸ˜ Zookeeper<br/>Pods: 3]
                        end
                        
                        Redis[ğŸ”´ Redis Cluster<br/>ìºì‹œ + ì„¸ì…˜<br/>Master: 1 Slaves: 2]
                        PostgresProxy[ğŸ˜ PostgreSQL Proxy<br/>Connection Pooling]
                    end
                    
                    %% Monitoring
                    subgraph Monitoring["ğŸ“Š monitoring namespace"]
                        Prometheus[ğŸ“ˆ Prometheus<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘<br/>Pod: 1]
                        Grafana[ğŸ“Š Grafana<br/>ì‹œê°í™”<br/>Pod: 1]
                        AlertManager[ğŸš¨ AlertManager<br/>ì•Œë¦¼<br/>Pod: 1]
                    end
                end
            end
        end
        
        %% AWS ê´€ë¦¬í˜• ì„œë¹„ìŠ¤
        subgraph ManagedServices["ğŸ› ï¸ AWS ê´€ë¦¬í˜• ì„œë¹„ìŠ¤"]
            RDS[ğŸ—„ï¸ RDS PostgreSQL<br/>Multi-AZ<br/>ì›¹ ì„œë¹„ìŠ¤ DB]
            S3[ğŸª£ S3 Data Lake<br/>ì›ë³¸ ë¦¬ë·° ë°ì´í„°<br/>íŒŒí‹°ì…˜ êµ¬ì¡°]
            Redshift[ğŸ­ Redshift<br/>Data Warehouse<br/>ë¶„ì„ ê²°ê³¼ ì €ì¥]
            ECR[ğŸ“¦ ECR<br/>Container Registry]
            SecretsManager[ğŸ” Secrets Manager<br/>ì¸ì¦ ì •ë³´ ê´€ë¦¬]
            CloudWatch[ğŸ“Š CloudWatch<br/>ë¡œê·¸ + ë©”íŠ¸ë¦­]
        end
    end
    
    %% ì—°ê²° ê´€ê³„
    User --> Internet
    Internet --> ALB
    ALB --> Ingress
    Ingress --> Frontend
    Ingress --> BackendAPI
    Ingress --> AirflowWebserver
    
    %% ì›¹ ì„œë¹„ìŠ¤ ë‚´ë¶€ í†µì‹ 
    Frontend --> BackendAPI
    BackendAPI --> WebSocket
    BackendAPI --> Redis
    BackendAPI --> PostgresProxy
    BackendAPI --> Kafka1
    
    %% VPN ì—°ê²°
    VPNClient -.->|VPN í„°ë„| VPNGateway
    CrawlingServer --> VPNClient
    VPNGateway --> Kafka2
    
    %% Airflow ì›Œí¬í”Œë¡œìš°
    AirflowScheduler --> AirflowWorker
    AirflowWorker -.->|API í˜¸ì¶œ| CrawlingServer
    AirflowWorker --> SparkCluster
    AirflowWorker --> AnalysisServer
    
    %% ë°ì´í„° í”Œë¡œìš°
    CrawlingServer -.->|VPN| Kafka2
    Kafka2 --> SparkCluster
    SparkCluster --> Kafka3
    Kafka3 --> AnalysisServer
    
    %% ë°ì´í„° ì €ì¥
    CrawlingServer -.->|VPN| S3
    SparkCluster --> S3
    SparkCluster --> Redshift
    AnalysisServer --> Redshift
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    PostgresProxy --> RDS
    
    %% Kafka í´ëŸ¬ìŠ¤í„°
    Kafka1 --> Zookeeper
    Kafka2 --> Zookeeper
    Kafka3 --> Zookeeper
    
    %% ëª¨ë‹ˆí„°ë§
    Prometheus --> BackendAPI
    Prometheus --> Kafka1
    Prometheus --> Redis
    Prometheus --> AirflowScheduler
    Grafana --> Prometheus
    AlertManager --> Prometheus
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°
    BackendAPI --> SecretsManager
    AirflowScheduler --> SecretsManager
    AnalysisServer --> S3
    
    %% ë¡œê¹…
    BackendAPI --> CloudWatch
    AirflowScheduler --> CloudWatch
    AnalysisServer --> CloudWatch
    CrawlingServer -.->|VPN| CloudWatch
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef local fill:#FFF2CC,stroke:#D6B656,stroke-width:3px,color:#000
    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef k8s fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef app fill:#4CAF50,stroke:#fff,stroke-width:2px,color:#fff
    classDef data fill:#2196F3,stroke:#fff,stroke-width:2px,color:#fff
    classDef monitor fill:#FF5722,stroke:#fff,stroke-width:2px,color:#fff
    classDef airflow fill:#017CEE,stroke:#fff,stroke-width:2px,color:#fff
    classDef vpn fill:#9C27B0,stroke:#fff,stroke-width:2px,color:#fff
    
    class Local,CrawlingServer local
    class AWS,ManagedServices aws
    class EKS,WebTier,AppTier,PipelineTier,DataTier k8s
    class Frontend,BackendAPI,WebSocket,AnalysisServer app
    class KafkaCluster,Redis,PostgresProxy,RDS,S3,Redshift data
    class Monitoring,Prometheus,Grafana,AlertManager monitor
    class AirflowCluster,AirflowScheduler,AirflowWebserver,AirflowWorker airflow
    class VPNClient,VPNGateway vpn
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë°ì´í„° í”Œë¡œìš° -->
            <div id="dataflow" class="diagram-section">
                <h2>ğŸ”„ ë°ì´í„° í”Œë¡œìš° (ìˆ˜ì •ë¨)</h2>
                <div class="description">
                    <h3>í•˜ì´ë¸Œë¦¬ë“œ ë°ì´í„° ì²˜ë¦¬ íë¦„</h3>
                    <p>ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„ì—ì„œ ì‹œì‘ë˜ì–´ EKS í´ëŸ¬ìŠ¤í„°ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ì „ì²´ ë°ì´í„° í”Œë¡œìš°ì…ë‹ˆë‹¤.</p>
                </div>
                <div class="diagram-container">
                    <div class="diagram-wrapper">
                        <div class="mermaid">
sequenceDiagram
    participant User as ğŸ‘¤ ì‚¬ìš©ì
    participant Frontend as âš›ï¸ Frontend
    participant API as ğŸ–¥ï¸ Backend API
    participant WS as ğŸ”Œ WebSocket
    participant Kafka as ğŸ“¨ Kafka
    participant Airflow as ğŸŒŠ Airflow
    participant LocalCrawler as ğŸ  ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„
    participant Spark as âš¡ Spark
    participant Analysis as ğŸ§  Analysis
    participant S3 as ğŸª£ S3
    participant Redshift as ğŸ­ Redshift
    participant DB as ğŸ—„ï¸ Database
    participant Cache as ğŸ”´ Redis
    
    User->>Frontend: ìƒí’ˆ ë¶„ì„ ìš”ì²­
    Frontend->>API: POST /api/analysis/start
    API->>Kafka: ë¶„ì„ ìš”ì²­ ë©”ì‹œì§€ ë°œí–‰
    API->>Cache: ìš”ì²­ ìƒíƒœ ìºì‹±
    API-->>Frontend: ë¶„ì„ ID ë°˜í™˜
    
    Frontend->>WS: WebSocket ì—°ê²° (ë¶„ì„ ID)
    
    Kafka->>Airflow: ë©”ì‹œì§€ ìˆ˜ì‹  ë° DAG íŠ¸ë¦¬ê±°
    Airflow->>LocalCrawler: API í˜¸ì¶œë¡œ í¬ë¡¤ë§ ì‘ì—… ì‹œì‘
    
    Note over LocalCrawler: VPNì„ í†µí•´ EKSì™€ í†µì‹ 
    
    loop í¬ë¡¤ë§ ì§„í–‰
        LocalCrawler-->>Kafka: VPNì„ í†µí•œ ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
        Kafka->>API: ìƒíƒœ ë©”ì‹œì§€ ìˆ˜ì‹ 
        API->>WS: ì‹¤ì‹œê°„ ìƒíƒœ ì „ì†¡
        WS-->>Frontend: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    end
    
    LocalCrawler-->>S3: VPNì„ í†µí•œ ì›ë³¸ ë°ì´í„° ì €ì¥
    LocalCrawler-->>Kafka: VPNì„ í†µí•œ ìˆ˜ì§‘ëœ ë¦¬ë·° ë°ì´í„° ì „ì†¡
    
    Kafka->>Spark: ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ì²˜ë¦¬ ì‹œì‘
    Spark->>S3: ì „ì²˜ë¦¬ëœ ë°ì´í„° ì €ì¥
    Spark->>Kafka: ì²˜ë¦¬ëœ ë°ì´í„° ì „ì†¡
    
    Kafka->>Analysis: ë¶„ì„ ì‘ì—… ì‹œì‘
    
    loop ë¶„ì„ ì§„í–‰
        Analysis->>Kafka: ë¶„ì„ ì§„í–‰ ìƒíƒœ
        Kafka->>API: ìƒíƒœ ë©”ì‹œì§€ ìˆ˜ì‹ 
        API->>WS: ì‹¤ì‹œê°„ ìƒíƒœ ì „ì†¡
        WS-->>Frontend: ë¶„ì„ ì§„í–‰ë¥ 
        
        Analysis->>Kafka: ê°œë³„ ê°ì • ì¹´ë“œ ê²°ê³¼
        Kafka->>API: ì¹´ë“œ ë°ì´í„° ìˆ˜ì‹ 
        API->>Cache: ì¹´ë“œ ë°ì´í„° ì„ì‹œ ì €ì¥
        API->>WS: ì‹¤ì‹œê°„ ì¹´ë“œ ì „ì†¡
        WS-->>Frontend: ê°ì • ì¹´ë“œ í‘œì‹œ
    end
    
    Analysis->>Redshift: ìµœì¢… ë¶„ì„ ê²°ê³¼ ì €ì¥
    Analysis->>DB: ì›¹ ì„œë¹„ìŠ¤ìš© ê²°ê³¼ ì €ì¥
    Analysis->>Kafka: ë¶„ì„ ì™„ë£Œ ì•Œë¦¼
    Kafka->>API: ì™„ë£Œ ë©”ì‹œì§€ ìˆ˜ì‹ 
    API->>WS: ë¶„ì„ ì™„ë£Œ ì•Œë¦¼
    WS-->>Frontend: ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
    
    Frontend->>API: GET /api/analysis/{id}/results
    API->>DB: ë¶„ì„ ê²°ê³¼ ì¡°íšŒ
    API->>Cache: ê²°ê³¼ ìºì‹±
    API-->>Frontend: ë¶„ì„ ê²°ê³¼ ë°˜í™˜
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Airflow DAG -->
            <div id="airflow" class="diagram-section">
                <h2>ğŸŒŠ Airflow DAG êµ¬ì¡°</h2>
                <div class="description">
                    <h3>ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</h3>
                    <p>Airflowê°€ ê´€ë¦¬í•˜ëŠ” 3ê°€ì§€ ì£¼ìš” DAG: ì‹¤ì‹œê°„ ë‹¨ì¼ ìƒí’ˆ ë¶„ì„, ê²€ìƒ‰ì–´ ê¸°ë°˜ ë‹¤ì¤‘ ìƒí’ˆ ë¶„ì„, ê´€ì‹¬ ìƒí’ˆ ë°°ì¹˜ ë¶„ì„</p>
                </div>
                <div class="diagram-container">
                    <div class="diagram-wrapper">
                        <div class="mermaid">
graph TB
    %% ì‹¤ì‹œê°„ ë‹¨ì¼ ìƒí’ˆ ë¶„ì„ DAG
    subgraph SingleProductDAG["ğŸ”„ ì‹¤ì‹œê°„ ë‹¨ì¼ ìƒí’ˆ ë¶„ì„ DAG"]
        SP_Start[ğŸ“¥ ë¶„ì„ ìš”ì²­ ìˆ˜ì‹ <br/>Kafka Consumer]
        SP_Trigger[ğŸš€ ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„<br/>API í˜¸ì¶œ]
        SP_Monitor[ğŸ‘€ í¬ë¡¤ë§ ìƒíƒœ ëª¨ë‹ˆí„°ë§<br/>Sensor]
        SP_Stream[âš¡ Spark ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬<br/>SparkSubmitOperator]
        SP_Analyze[ğŸ§  LLM ê°ì • ë¶„ì„<br/>KubernetesPodOperator]
        SP_Store[ğŸ’¾ ê²°ê³¼ ì €ì¥<br/>PythonOperator]
        SP_Notify[ğŸ“¢ ì™„ë£Œ ì•Œë¦¼<br/>Kafka Producer]
        
        SP_Start --> SP_Trigger
        SP_Trigger --> SP_Monitor
        SP_Monitor --> SP_Stream
        SP_Stream --> SP_Analyze
        SP_Analyze --> SP_Store
        SP_Store --> SP_Notify
    end
    
    %% ê²€ìƒ‰ì–´ ê¸°ë°˜ ë‹¤ì¤‘ ìƒí’ˆ ë¶„ì„ DAG
    subgraph MultiProductDAG["ğŸ” ê²€ìƒ‰ì–´ ê¸°ë°˜ ë‹¤ì¤‘ ìƒí’ˆ ë¶„ì„ DAG"]
        MP_Start[ğŸ“¥ ê²€ìƒ‰ ìš”ì²­ ìˆ˜ì‹ <br/>Kafka Consumer]
        MP_GetProducts[ğŸ›ï¸ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ<br/>ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„]
        MP_CreateTasks[âš™ï¸ ë™ì  íƒœìŠ¤í¬ ìƒì„±<br/>PythonOperator]
        
        subgraph MP_Parallel["ë³‘ë ¬ ì²˜ë¦¬"]
            MP_Crawl1[ğŸ•·ï¸ ìƒí’ˆ1 í¬ë¡¤ë§]
            MP_Crawl2[ğŸ•·ï¸ ìƒí’ˆ2 í¬ë¡¤ë§]
            MP_CrawlN[ğŸ•·ï¸ ìƒí’ˆN í¬ë¡¤ë§]
        end
        
        MP_Aggregate[ğŸ“Š ê²°ê³¼ ì§‘ê³„<br/>SparkSubmitOperator]
        MP_Compare[ğŸ“ˆ ìƒí’ˆ ë¹„êµ ë¶„ì„<br/>PythonOperator]
        MP_StoreResults[ğŸ’¾ ë¹„êµ ê²°ê³¼ ì €ì¥<br/>Redshift]
        
        MP_Start --> MP_GetProducts
        MP_GetProducts --> MP_CreateTasks
        MP_CreateTasks --> MP_Crawl1
        MP_CreateTasks --> MP_Crawl2
        MP_CreateTasks --> MP_CrawlN
        MP_Crawl1 --> MP_Aggregate
        MP_Crawl2 --> MP_Aggregate
        MP_CrawlN --> MP_Aggregate
        MP_Aggregate --> MP_Compare
        MP_Compare --> MP_StoreResults
    end
    
    %% ê´€ì‹¬ ìƒí’ˆ ë°°ì¹˜ ë¶„ì„ DAG
    subgraph BatchDAG["â° ê´€ì‹¬ ìƒí’ˆ ë°°ì¹˜ ë¶„ì„ DAG"]
        B_Schedule[ğŸ“… ìŠ¤ì¼€ì¤„ íŠ¸ë¦¬ê±°<br/>ë§¤ì¼ ìƒˆë²½ 2ì‹œ]
        B_GetWatchlist[ğŸ“‹ ê´€ì‹¬ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ<br/>PostgreSQL]
        B_BatchCrawl[ğŸ•·ï¸ ë°°ì¹˜ í¬ë¡¤ë§<br/>ë¡œì»¬ ì„œë²„ API]
        B_S3Store[ğŸª£ S3 ë°ì´í„° ì ì¬<br/>íŒŒí‹°ì…˜ë³„ ì €ì¥]
        B_SparkBatch[âš¡ Spark ë°°ì¹˜ ì²˜ë¦¬<br/>ëŒ€ìš©ëŸ‰ ë°ì´í„° ë¶„ì„]
        B_LLMOnDemand[ğŸ§  ì˜¨ë””ë§¨ë“œ LLM ë¶„ì„<br/>í•„ìš”ì‹œì—ë§Œ êµ¬ë™]
        B_RedshiftLoad[ğŸ­ Redshift ì ì¬<br/>COPY ëª…ë ¹]
        B_TrendAnalysis[ğŸ“ˆ ì¶”ì´ ë¶„ì„<br/>ì‹œê³„ì—´ ë°ì´í„°]
        B_PriceAlert[ğŸ’° ê°€ê²© ì•Œë¦¼<br/>í• ì¸ ê°ì§€]
        
        B_Schedule --> B_GetWatchlist
        B_GetWatchlist --> B_BatchCrawl
        B_BatchCrawl --> B_S3Store
        B_S3Store --> B_SparkBatch
        B_SparkBatch --> B_LLMOnDemand
        B_LLMOnDemand --> B_RedshiftLoad
        B_RedshiftLoad --> B_TrendAnalysis
        B_TrendAnalysis --> B_PriceAlert
    end
    
    %% ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²°
    LocalCrawler[ğŸ  ë¡œì»¬ í¬ë¡¤ë§ ì„œë²„<br/>FastAPI + Selenium]
    KafkaSystem[ğŸ“¨ Kafka í´ëŸ¬ìŠ¤í„°<br/>ë©”ì‹œì§€ í]
    SparkCluster[âš¡ Spark í´ëŸ¬ìŠ¤í„°<br/>ë¶„ì‚° ì²˜ë¦¬]
    LLMServer[ğŸ§  LLM ë¶„ì„ ì„œë²„<br/>GPU ê¸°ë°˜]
    
    %% DAGì™€ ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²°
    SP_Trigger -.->|API í˜¸ì¶œ| LocalCrawler
    MP_GetProducts -.->|API í˜¸ì¶œ| LocalCrawler
    B_BatchCrawl -.->|API í˜¸ì¶œ| LocalCrawler
    
    SP_Start -.->|ë©”ì‹œì§€ ìˆ˜ì‹ | KafkaSystem
    SP_Notify -.->|ë©”ì‹œì§€ ë°œí–‰| KafkaSystem
    
    SP_Stream -.->|ì‘ì—… ì œì¶œ| SparkCluster
    MP_Aggregate -.->|ì‘ì—… ì œì¶œ| SparkCluster
    B_SparkBatch -.->|ì‘ì—… ì œì¶œ| SparkCluster
    
    SP_Analyze -.->|Pod ì‹¤í–‰| LLMServer
    B_LLMOnDemand -.->|Pod ì‹¤í–‰| LLMServer
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef dag fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#000
    classDef task fill:#F3E5F5,stroke:#7B1FA2,stroke-width:1px,color:#000
    classDef parallel fill:#E8F5E8,stroke:#388E3C,stroke-width:1px,color:#000
    classDef external fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#000
    
    class SingleProductDAG,MultiProductDAG,BatchDAG dag
    class SP_Start,SP_Trigger,SP_Monitor,SP_Stream,SP_Analyze,SP_Store,SP_Notify task
    class MP_Start,MP_GetProducts,MP_CreateTasks,MP_Aggregate,MP_Compare,MP_StoreResults task
    class B_Schedule,B_GetWatchlist,B_BatchCrawl,B_S3Store,B_SparkBatch,B_LLMOnDemand,B_RedshiftLoad,B_TrendAnalysis,B_PriceAlert task
    class MP_Crawl1,MP_Crawl2,MP_CrawlN parallel
    class LocalCrawler,KafkaSystem,SparkCluster,LLMServer external
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentZoom = 1;
        
        // Mermaid ì´ˆê¸°í™”
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'Arial, sans-serif',
            fontSize: 16,
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 30,
                nodeSpacing: 80,
                rankSpacing: 100
            },
            sequence: {
                useMaxWidth: false,
                width: 200,
                height: 100,
                actorMargin: 80,
                boxMargin: 15,
                messageMargin: 50
            }
        });

        function showDiagram(diagramId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sections = document.querySelectorAll('.diagram-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            const targetSection = document.getElementById(diagramId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            event.target.classList.add('active');
            
            // ì¤Œ ë¦¬ì…‹
            resetZoom();
            
            // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            applyZoom();
        }
        
        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.3);
            applyZoom();
        }
        
        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }
        
        function fitToScreen() {
            const container = document.querySelector('.diagram-section.active .diagram-container');
            const diagram = document.querySelector('.diagram-section.active .diagram-wrapper');
            if (container && diagram) {
                const containerWidth = container.clientWidth - 40;
                const diagramWidth = diagram.scrollWidth;
                currentZoom = Math.min(containerWidth / diagramWidth, 1);
                applyZoom();
            }
        }
        
        function applyZoom() {
            const activeDiagram = document.querySelector('.diagram-section.active .diagram-wrapper');
            if (activeDiagram) {
                activeDiagram.style.transform = `scale(${currentZoom})`;
            }
            
            // ì¤Œ ë ˆë²¨ í‘œì‹œ ì—…ë°ì´íŠ¸
            const zoomDisplay = Math.round(currentZoom * 100);
            document.querySelector('.zoom-controls .zoom-btn:nth-child(3)').textContent = `${zoomDisplay}%`;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸° ì„¤ì •
        window.addEventListener('load', function() {
            setTimeout(() => {
                mermaid.init();
                setTimeout(fitToScreen, 1000);
            }, 100);
        });
    </script>
</body>
</html>